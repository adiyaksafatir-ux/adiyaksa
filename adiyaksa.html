<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris Klasik Sederhana (Satu File)</title>
    
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f4f4;
            margin: 0;
        }

        .game-container {
            display: flex;
            gap: 30px;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        /* Pengaturan GRID Tetris */
        #grid {
            width: 200px; /* 10 kotak * 20px/kotak */
            height: 400px; /* 20 kotak * 20px/kotak */
            background-color: #111;
            display: flex;
            flex-wrap: wrap;
            border: 5px solid #333;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        /* Setiap Kotak (Cell) di dalam Grid */
        .square {
            width: 20px;
            height: 20px;
            box-sizing: border-box;
            border: 1px solid #333; /* Garis pemisah antar blok */
        }

        /* Styling untuk Block yang aktif */
        .block {
            /* Warna L-Block */
            background-color: orange; 
            border: 2px outset #eee; /* Efek 3D ringan */
        }

        .taken {
            /* Warna blok yang sudah terkunci */
            background-color: gray;
        }

        .sidebar {
            padding-top: 50px;
        }

        #start-button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            display: block;
        }

        .controls-info {
            font-size: 0.9em;
            color: #666;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Tetris Sederhana</h1>
        <div id="grid"></div>

        <div class="sidebar">
            <p>Skor: <span id="score">0</span></p>
            <p>Level: <span id="level">1</span></p>
            <button id="start-button">Mulai / Jeda</button>
            <p class="controls-info">Kontrol: Panah Kiri/Kanan/Bawah, Spasi (Putar)</p>
        </div>
    </div>

    <script>
        // --- Konstanta Dasar ---
        const grid = document.getElementById('grid');
        const scoreDisplay = document.getElementById('score');
        const startButton = document.getElementById('start-button');
        const width = 10; // Lebar grid (10 kotak)
        const height = 20; // Tinggi grid (20 kotak)
        let squares = []; // Array untuk menyimpan semua kotak (cell)
        let currentPosition = 4; // Posisi awal balok
        let score = 0;
        let timerId = null; // Untuk mengontrol kecepatan jatuh

        // --- Bentuk Balok (Tetrominoes) ---
        // Representasi 4 kotak untuk setiap bentuk.
        const lTetromino = [
            [1, width + 1, width * 2 + 1, 2],
            [width, width + 1, width + 2, width * 2 + 2],
            [1, width + 1, width * 2 + 1, width * 2],
            [width, width * 2, width * 2 + 1, width * 2 + 2]
        ];

        // Untuk contoh ini, kita hanya menggunakan satu bentuk (L)
        const theTetrominoes = [lTetromino];
        let currentTetromino = theTetrominoes[0][0]; 
        let currentRotation = 0;

        // --- 1. Fungsi Membuat Grid ---
        function createGrid() {
            // Hapus grid yang ada (untuk restart)
            grid.innerHTML = ''; 
            squares = []; 

            for (let i = 0; i < width * height; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                grid.appendChild(square);
                squares.push(square);
            }
            // Tambahkan baris "dasar" tak terlihat untuk mendeteksi tabrakan
            for (let i = 0; i < width; i++) {
                const square = document.createElement('div');
                square.classList.add('square', 'taken'); // 'taken' = terisi/dasar
                // Tambahkan ID 'bottom' agar terlihat berbeda di konsol
                square.id = 'bottom'; 
                grid.appendChild(square);
                squares.push(square);
            }
        }

        // --- 2. Fungsi Menggambar Balok ---
        function draw() {
            currentTetromino.forEach(index => {
                // Tambahkan class 'block' ke kotak (square) yang sesuai
                squares[currentPosition + index].classList.add('block');
            });
        }

        // --- 3. Fungsi Menghapus Balok (Untuk Pergerakan) ---
        function undraw() {
            currentTetromino.forEach(index => {
                squares[currentPosition + index].classList.remove('block');
            });
        }

        // --- 4. Fungsi Gerak Turun (Otomatis) ---
        function moveDown() {
            undraw();
            
            // Pengecekan tabrakan (sederhana)
            const isAtBottom = currentTetromino.some(index =>
                squares[currentPosition + index + width].classList.contains('taken')
            );

            if (isAtBottom) {
                // Jika menabrak, 'kunci' balok di posisi ini
                freeze();
                generateNewTetromino();
                return;
            }

            currentPosition += width;
            draw();
        }

        // --- 5. Fungsi Mengunci Balok (Freeze) ---
        function freeze() {
            currentTetromino.forEach(index =>
                squares[currentPosition + index].classList.add('taken')
            );
            // *** Di sini seharusnya ada: pengecekan baris penuh (checkRows()) ***
        }

        // --- 6. Fungsi Balok Baru ---
        function generateNewTetromino() {
            // Memilih balok acak (indeks balok dan rotasi acak)
            const randomTetrominoIndex = Math.floor(Math.random() * theTetrominoes.length);
            const randomRotation = Math.floor(Math.random() * theTetrominoes[randomTetrominoIndex].length);

            currentTetromino = theTetrominoes[randomTetrominoIndex][randomRotation];
            currentPosition = 4; // Reset posisi di atas

            // Pengecekan Game Over: Jika posisi baru langsung menabrak
            if (currentTetromino.some(index => squares[currentPosition + index].classList.contains('taken'))) {
                clearInterval(timerId);
                timerId = null;
                alert('Game Over! Skor Anda: ' + score);
                startButton.textContent = 'Mulai Ulang';
                document.removeEventListener('keydown', control);
                return;
            }

            draw();
        }

        // --- 7. Fungsi Kontrol Keyboard ---
        function control(e) {
            if (timerId === null) return; // Jangan bergerak jika game dijeda

            if (e.key === 'ArrowLeft') {
                moveLeft();
            } else if (e.key === 'ArrowRight') {
                moveRight();
            } else if (e.key === 'ArrowDown') {
                moveDown();
            } else if (e.key === ' ') { // Spasi untuk Rotasi
                rotate();
            }
        }

        function moveLeft() {
            undraw();
            const isAtLeftEdge = currentTetromino.some(index => (currentPosition + index) % width === 0);
            const isBlocked = currentTetromino.some(index =>
                squares[currentPosition + index - 1].classList.contains('taken')
            );

            if (!isAtLeftEdge && !isBlocked) {
                currentPosition -= 1;
            }
            draw();
        }

        function moveRight() {
            undraw();
            const isAtRightEdge = currentTetromino.some(index => (currentPosition + index) % width === width - 1);
            const isBlocked = currentTetromino.some(index =>
                squares[currentPosition + index + 1].classList.contains('taken')
            );

            if (!isAtRightEdge && !isBlocked) {
                currentPosition += 1;
            }
            draw();
        }
        
        function rotate() {
             undraw();
             currentRotation++;
             // Jika sudah mencapai rotasi terakhir, kembali ke rotasi 0
             if (currentRotation === theTetrominoes[0].length) { 
                 currentRotation = 0;
             }
             currentTetromino = theTetrominoes[0][currentRotation];
             
             // Tambahkan pengecekan jika rotasi menyebabkan tabrakan
             // Untuk saat ini, kita abaikan pengecekan tabrakan rotasi.
             
             draw();
        }

        // --- 8. Fungsi Mulai/Jeda Game ---
        function startGame() {
            if (timerId) {
                clearInterval(timerId); // Jeda Game
                timerId = null;
                startButton.textContent = 'Lanjutkan';
                document.removeEventListener('keydown', control);
            } else {
                if (startButton.textContent === 'Mulai Ulang') {
                    // Reset game state
                    score = 0;
                    scoreDisplay.textContent = score;
                    // Implementasi reset lainnya (level, dll.)
                }

                // Setup Grid dan Balok Awal
                createGrid();
                generateNewTetromino();

                // Mulai Game Loop (Balok Turun setiap 1 detik)
                timerId = setInterval(moveDown, 1000);
                document.addEventListener('keydown', control);
                startButton.textContent = 'Jeda';
            }
        }

        // --- Inisialisasi ---
        startButton.addEventListener('click', startGame);

    </script>
</body>
</html>
